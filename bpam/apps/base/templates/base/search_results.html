{% extends "base.html" %}
{% load static from staticfiles %}
{% block title %}Search Results {% endblock %}
{% block content %}
{% load django_bootstrap_breadcrumbs %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "BASE" "base:index" %}
    {% breadcrumb "Search" "base:search" %}
{% endblock %}

{% if search_form %}
<script src="{% static 'base/spin.min.js' %}"></script>
<div class="container-fluid">
    <form id="search_form" action="" class="form-inline" role="form" method="post">{% csrf_token %}

        <div class="alert alert-info">
            Use this facililty to search BASE data for samples of interest
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <input class="form-control" name="search_all" type="checkbox" value="search_all" id="search_all">
                Search All Samples ?
            </div>
            <div id="search_panel" class="panel-body">
                <input class="form-control" id="add_search_term" type="button" value="+"/>
                <input class="form-control" id="remove_search_term" value="-" type="button"/>
                Find samples with
                <input name="search_operator" class="form-control" type="radio" id="op_and" value="and"
                checked="checked">All
                or
                <input class="form-control" name="search_operator" type="radio" id="op_or" value="or">Any
                of the matching fields added below:
                <table id="search_terms" class="table table-bordered table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>Search Type</th>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td width="10%">
                            <input class="form-control" name="search_type0" type="radio" id="field0" value="field"
                            checked="checked">Single
                            <input class="form-control" name="search_type0" type="radio" id="range0" value="range">Range
                        </td>

                        <td width="25%">
                            <select class="form-control" id="search_field0" name="search_field0"> </select>
                        </td>

                        <td width="65%">
                            <select class="form-control" id="search_standardised_value0"
                                name="search_standardised_value0">
                            </select>
                            <input class="form-control" id="search_range_min0" name="search_range_min0" type=text>
                            <input class="form-control" id="search_range_max0" name="search_range_max0" type=text>
                            <input class="form-control" id="search_value0" name="search_value0" type=text>
                            <button type="button" class="btn" data-toggle="popover"
                                title="Search Values"
                                data-trigger="focus"
                                data-content="Searches may comprise single values or ranges of values.  For example, samples could be filtered by pH 4 - 8, or by pH 4">
                                <span class="glyphicon glyphicon-info-sign"></span>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="validation" class="alert alert-danger"><span>Validation Errors Go Here</span></div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <input checked class="form-control" name="enable_taxonomic_filters" type="checkbox"
                value="enable_taxonomic_filters" id="enable_taxonomic_filters">
                Apply Taxonomic Filters ? <input class="form-control" type="button" id="clear_taxonomic_filters"
                value="clear"/>
            </div>
            <div id="taxononomic_filter_panel" class="panel-body">
                <table id="taxonomic_filter_table" class="table table-bordered table-striped table-condensed">
                    <thead>
                        <th>Level</th>
                        <th>Value</th>
                    </thead>
                    <tbody>
                    <tr>
                        <td width="10%">Kingdom</td>
                        <td><select class="form-control" id="kingdom" name="kingdom">
                                <option value="">---</option>
                                <option value="Bacteria">Bacteria</option>
                                <option value="Fungi">Fungi</option>
                                <option value="Archaea">Archaea</option>
                                <option value="Eukaryota">Eukaryota</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Phylum</td>
                        <td>
                            <select class="form-control" id="phylum" name="phylum"> </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Class</td>
                        <td>
                            <select class="form-control" id="otu_class" name="otu_class"> </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Order</td>
                        <td>
                            <select class="form-control" id="order" name="order"> </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Family</td>
                        <td>
                            <select class="form-control" id="family" name="family"> </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Genus</td>
                        <td>
                            <select class="form-control" id="genus" name="genus"> </select>
                        </tr>
                        <tr>
                            <td>Species</td>
                            <td>
                                <select class="form-control" id="species" name="species"> </select>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="button" id="search_button" class="btn btn-default" value="Search">
                    <span class="glyphicon glyphicon-search"> </span>
                    </input>
                </div>
                <div id="spinner" class="spinner"></div>
            </form>
        </div>

        <script>
            window.standardisedVocabularyEndPointURL = "{% url 'base:lookup' None %}".replace("None", "");
            window.TAXONOMY_URL = "{% url 'base:taxonomy' None None %}".replace("/None/None", "");
            window.SEARCH_FORM_URL = "{% url 'base:search' %}";
            window.EXPORT_RESULTS_URL = "{% url 'base:searchexport' %}";

            $(function () {
                    $('[data-toggle="tooltip"]').tooltip()
                    $('[data-toggle="popover"]').popover()
            })
        </script>

        <script src="{% static 'base/search.js' %}"></script>
        {% endif %}

        <div class="container-fluid">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Search Results
                    <input align=right type="button" id="export_button" class="btn btn-default" value="Export search results">
                    <button type="button" class="btn" data-toggle="popover"
                        title="Search Result"
                        data-trigger="focus"
                        data-content="Export an OTU abundance table, OTU taxonomy and representative OTU sequences for samples filling filtered search.">
                        <span class="glyphicon glyphicon-info-sign"></span>
                    </button>
                </div>
                <div class="panel-body">
                    <table id="results" class="table table-striped tablesorter table-bordered">
                        <thead>
                            <tr>
                                <th>BPA ID</th>
                                <th><span class="glyphicon glyphicon-picture"></span> Sample Context</th>
                                <th>Chemical Analysis</th>
                                <th>Amplicon</th>
                                <th>Metagenomics</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <script>
                        $(document).ready(function () {
                                $(function () {
                                    $("#results").tablesorter();
                                    });
                                });
                    </script>
                </div>
            </div>
        </div>
        {% endblock %}
    </div>
</div>
