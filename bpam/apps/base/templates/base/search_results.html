{% extends "base.html" %}
{% block title %}Search Results {% endblock %}
{% block content %}
    {% if search_form %}

        <form  action="" class="form-inline" role="form" method="post">{% csrf_token %}
              <div class="panel panel-default">
                  <div class="panel-heading">Search Form</div>
                  <div class="panel-body">
                       {{ search_form.as_p }}
                  </div>
              </div>
            <input type="submit" class="btn btn-default" value="Search" />
            <div id="search_selection">
            <input class="form-control" name="search_type" type="radio" id="field" value="field" checked="checked">Field Search</>
            <input class="form-control" name="search_type" type="radio" id="range" value="range">Range Search</>
            </div>
        </form>
        <script>
             $(document).ready(function () {
                var auto_complete_url = "{% url 'base:auto_complete' None  %}".replace("None","");

                function showCorrectSearchFields() {
                    var isSingleSearch = $("#id_search_field").val() != "";
                    if (isSingleSearch) {
                         $(rangeSearchFields).hide();
                         $(singleSearchFields).show();
                         $("#field").prop("checked",true);
                    }
                    else {
                         $(rangeSearchFields).show();
                         $(singleSearchFields).hide();
                        $("#range").prop("checked",true);
                    }
                }

                function clearRangeFields() {
                    $("#id_search_range").val("");
                    $("#id_search_range_min").val("");
                    $("#id_search_range_max").val("");
                }

                function clearSingleFields() {
                    $("#id_search_field").val("");
                    $("#id_search_value").val("");
                }

                var rangeSearchFields = "label[for='id_search_range']," +
                        "#id_search_range," +
                        "label[for='id_search_range_min']," +
                        "#id_search_range_min," +
                        "label[for='id_search_range_max']," +
                        "#id_search_range_max";

                var singleSearchFields = "label[for='id_search_field']," +
                        "#id_search_field," +
                        "label[for='id_search_value'],"+
                        "#id_search_value";

                showCorrectSearchFields();

                $("input[name='search_type']").change(function (){
                     var sel = $("input[name='search_type']:checked").val();
                     if (sel == 'field'){
                        clearRangeFields();
                        $(rangeSearchFields).hide();
                        $(singleSearchFields).show();
                     }
                     else {
                        clearSingleFields();
                        $(singleSearchFields).hide();
                        $(rangeSearchFields).show();
                     }
                 });

                 $("#id_search_field").change(function () {
                      $(".typeahead").unbind();
                      var standardisedVocabularyOptions = new Bloodhound({
                      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
                      queryTokenizer: Bloodhound.tokenizers.whitespace,
                      remote: auto_complete_url + $('#id_search_field').val() + "?q=%QUERY"
                     });

                      standardisedVocabularyOptions.initialize();

                     $("#id_search_value").typeahead(null, {
                          name: 'standardised-vocabulary-options',
                          displayKey: 'name',
                          source: standardisedVocabularyOptions.ttAdapter()
                     });

                 })


             });

        </script>

    {% endif %}

    {% if request.POST %}
        <div class="panel panel-default">
        <div class="panel-heading">Results</div>
        <div class="panel-body">

        {% if samples %}
            <table id="samples" class="table table-striped tablesorter">
                <thead>
                    <tr>
                        <th>BPA ID</th>
                        <th>Sample Context</th>
                        <th>Chemical Analysis</th>
                        <th>XXX</th>
                        <th>YYY</th>
    </tr>
    </thead>
    <tbody>
    {% for sample in samples %}
    <tr>
        <td>
            {{ sample.bpa_id }}
        </td>
        <td>
            <a href="{% url 'basecontextual:sampledetail' sample.context.pk %}">Sample Context</a>
        </td>
        <td>

            <a href="todo">Chemical Analysis</a>

        </td>
        <td>todo</td>
        <td>todo</td>
        <td>todo</td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% if is_paginated %}
<ul class="pagination pagination-centered">
    {% if page_obj.has_previous %}
    <li><a href="?page=1"><<</a></li>
    <li><a href="?page={{ page_obj.previous_page_number }}"><</a></li>
    {% endif %}

    {% for i in paginator.page_range %}
    <li
    {% if page_obj.number == i %} class="active" {% endif %}><a href="?page={{i}}">{{i}}</a></li>
    {% endfor %}

    {% if page_obj.has_next %}
    <li><a href="?page={{ page_obj.next_page_number }}">></a></li>
    <li><a href="?page={{ page_obj.paginator.num_pages }}">>></a></li>
    {% endif %}
</ul>
{% endif %}


<script>
    $(document).ready(function () {
        $(function () {
            $("#samples").tablesorter();
        });
    });
</script>

{% else %}
<h3> No Results </h3>
{% endif %}
    </div>
    </div>
    {% endif %}

{% endblock %}
