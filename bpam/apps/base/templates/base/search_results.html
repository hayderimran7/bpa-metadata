{% extends "base.html" %}
{% block title %}Search Results {% endblock %}
{% block content %}

    {% if search_form %}
        <form action="" class="form-inline" role="form" method="post">{% csrf_token %}
              <div class="panel panel-default">
                  <div class="panel-heading">Search Form</div>
                  <div class="panel-body">
                       {{ search_form.as_p }}
                  </div>
              </div>
            <input type="submit" class="btn btn-default" value="Search" />
            <div id="search_selection">
            <input class="form-control" name="search_type" type="radio" id="field" value="field" checked="checked">Field Search</>
            <input class="form-control" name="search_type" type="radio" id="range" value="range">Range Search</>
            </div>
        </form>
        <script>
             $(document).ready(function () {
                function showCorrectSearchFields() {
                    var isSingleSearch = $("#id_search_field").val() != "";
                    if (isSingleSearch) {
                         $(rangeSearchFields).hide();
                         $(singleSearchFields).show();
                         $("#field").prop("checked",true);
                    }
                    else {
                         $(rangeSearchFields).show();
                         $(singleSearchFields).hide();
                        $("#range").prop("checked",true);
                    }
                }

                function clearRangeFields() {
                    $("#id_search_range").val("");
                    $("#id_search_range_min").val("");
                    $("#id_search_range_max").val("");
                }

                function clearSingleFields() {
                    $("#id_search_field").val("");
                    $("#id_search_value").val("");
                }

                var rangeSearchFields = "label[for='id_search_range']," +
                        "#id_search_range," +
                        "label[for='id_search_range_min']," +
                        "#id_search_range_min," +
                        "label[for='id_search_range_max']," +
                        "#id_search_range_max";

                var singleSearchFields = "label[for='id_search_field']," +
                        "#id_search_field," +
                        "label[for='id_search_value'],"+
                        "#id_search_value";

                showCorrectSearchFields();

                $("input[name='search_type']").change(function (){
                     var sel = $("input[name='search_type']:checked").val();
                     if (sel == 'field'){
                        clearRangeFields();
                        $(rangeSearchFields).hide();
                        $(singleSearchFields).show();
                     }
                     else {
                        clearSingleFields();
                        $(singleSearchFields).hide();
                        $(rangeSearchFields).show();
                     }
                 });
                });
        </script>

    {% endif %}

<div class="container">

<h3>Search</h3>

<script type="text/javascript">
  var auto_complete_url = "{% url 'base:search_auto_complete' thing='' %}";
</script>

<form id="sample-search" action="" method="post" role="form">
  {% csrf_token %}

  <div class="row">
    <div class="col-xs-2">
      <select class="form-control" class="query-field">
        <option></option>
        <option selected="selected">Sample ID</option>
        <option>Date sampled</option>
        <option>Depth</option>
        <option>Horizon</option>
        <option>Description</option>
        <option>Current land use</option>
      </select>
    </div>
    <div class="col-xs-6">
      <input type="text" class="form-control query-value" placeholder="Sample ID">
    </div>
    <div class="col-xs-1">
      <button type="button" class="close" aria-hidden="true">&times;</button>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-2">
      <select class="form-control" class="query-field">
        <option></option>
        <option>Sample ID</option>
        <option>Date sampled</option>
        <option selected="selected">Depth</option>
        <option>Horizon</option>
        <option>Description</option>
        <option>Current land use</option>
      </select>
    </div>
    <div class="col-xs-6">
      <div class="row">
        <div class="col-xs-5">
          <input type="number" class="form-control" placeholder="min">
        </div>
        <div class="col-xs-2 text-center">—</div>
        <div class="col-xs-5">
          <input type="number" class="form-control" placeholder="max">
        </div>
      </div>
    </div>
    <div class="col-xs-1">
      <button type="button" class="close" aria-hidden="true">&times;</button>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-2">
      <select class="form-control" class="query-field">
        <option></option>
        <option>Sample ID</option>
        <option selected="selected">Date sampled</option>
        <option>Depth</option>
        <option>Horizon</option>
        <option>Description</option>
        <option>Current land use</option>
      </select>
    </div>
    <div class="col-xs-6">
      <div class="row">
        <div class="col-xs-5">
          <input type="date" class="form-control" placeholder="min">
        </div>
        <div class="col-xs-2 text-center">—</div>
        <div class="col-xs-5">
          <input type="date" class="form-control" placeholder="max">
        </div>
      </div>
    </div>
    <div class="col-xs-1">
      <button type="button" class="close" aria-hidden="true">&times;</button>
    </div>
  </div>

  <div class="row" style="margin-top: 1em;">
    <div class="col-xs-offset-2 col-xs-4">
      <button type="submit" class="btn btn-primary btn-lg">Search</button>
    </div>
    <div class="col-xs-6">
      <button type="button" class="btn btn-info btn-sm add-row">Add row</button>
    </div>
  </div>
</form>

</div>

        {% if search_form %}
        <h3>
           Search Form
        </h3>
        <form action="" method="post">{% csrf_token %}
        {{ search_form.as_p }}
        <input type="submit" value="Search" />
    </form>
    {% endif %}
    {% if request.POST %}
        <div class="panel panel-default">
        <div class="panel-heading">Results</div>
        <div class="panel-body">
        {% if result_type == "base_contextual" %}
            {% include "base_contextual/sample_table.html" %}
        {% elif result_type == "base_metagenomics" %}
            {% include "base_metagenomics/sample_table.html" %}
        {% endif %}
    </div>
    </div>
    {% endif %}

{% endblock %}
